<script>
// ---------------------------
// ğŸ”® ìë™ ë¦¬í¬íŠ¸ ìƒì„±(ê·¸ëŒ€ë¡œ ìœ ì§€)
// ---------------------------
const colors = {
  ëª©:{name:"ì´ˆë¡",emoji:"ğŸŒ³",desc:"ì„±ì¥ê³¼ í™•ì¥ì˜ ê¸°ìš´"},
  í™”:{name:"ë¶‰ì€",emoji:"ğŸ”¥",desc:"ì—´ì •ê³¼ ì¶”ì§„ì˜ ê¸°ìš´"},
  í† :{name:"ë…¸ë€",emoji:"ğŸŒ",desc:"ì•ˆì •ê³¼ ì¤‘ì‹¬ì˜ ê¸°ìš´"},
  ê¸ˆ:{name:"íšŒìƒ‰",emoji:"âš™ï¸",desc:"ì§ˆì„œì™€ ë…¼ë¦¬ì˜ ê¸°ìš´"},
  ìˆ˜:{name:"ë‚¨ìƒ‰",emoji:"ğŸ’§",desc:"ê°ì„±Â·ì§€í˜œì˜ ê¸°ìš´"}
};
const animals = ["ì¥","ì†Œ","í˜¸ë‘ì´","í† ë¼","ìš©","ë±€","ë§","ì–‘","ì›ìˆ­ì´","ë‹­","ê°œ","ë¼ì§€"];
const zones = {
  A:{name:"A-Zone",desc:"ì²´ê³„ì™€ ì •ë¦¬ë¥¼ ì¤‘ì‹œí•˜ëŠ” êµ¬ì¡°ì  ì„±í–¥"},
  B:{name:"B-Zone",desc:"ê³µê°ê³¼ ê´€ê³„ë¥¼ ì¤‘ì‹œí•˜ëŠ” ë”°ëœ»í•œ ì„±í–¥"},
  C:{name:"C-Zone",desc:"ì „ëµê³¼ ì°½ì¡°ë¥¼ ì¤‘ì‹œí•˜ëŠ” ë¶„ì„ì  ì„±í–¥"},
  D:{name:"D-Zone",desc:"ììœ ì™€ ëª°ì…ì„ ì¤‘ì‹œí•˜ëŠ” ê°ê°ì  ì„±í–¥"}
};

// 240ê°œ ìë™ ìƒì„±
const reports = {};
Object.keys(colors).forEach(oh=>{
  animals.forEach(an=>{
    const key = `${colors[oh].name} ${an}`;
    reports[key] = {};
    Object.keys(zones).forEach(z=>{
      reports[key][z] =
        `${colors[oh].emoji} <b>${key}</b> ${zones[z].name}<br><br>`+
        `${colors[oh].desc}ê³¼ ${zones[z].desc}ì´ ê²°í•©ë˜ì–´ `+
        `ë‹¹ì‹ ì€ '${key}'ì˜ ì—ë„ˆì§€ë¡œ ì„¸ìƒì„ íƒí—˜í•©ë‹ˆë‹¤. `+
        `ê· í˜• ì¡íŒ ì‚¬ê³ ì™€ ê°•í•œ ì§‘ì¤‘ë ¥ì„ í†µí•´ ìì‹ ë§Œì˜ ê¸¸ì„ ë§Œë“¤ì–´ê°€ëŠ” íƒ€ì…ì…ë‹ˆë‹¤.`;
    });
  });
});

// ---------------------------
// ğŸ§© ì •ê·œí™” ìœ í‹¸
// ---------------------------
const stemToColor = {ê°‘:"ì´ˆë¡",ì„:"ì´ˆë¡",ë³‘:"ë¶‰ì€",ì •:"ë¶‰ì€",ë¬´:"ë…¸ë€",ê¸°:"ë…¸ë€",ê²½:"íšŒìƒ‰",ì‹ :"íšŒìƒ‰",ì„:"ë‚¨ìƒ‰",ê³„:"ë‚¨ìƒ‰"};
const branchToAnimal = {ì:"ì¥",ì¶•:"ì†Œ",ì¸:"í˜¸ë‘ì´",ë¬˜:"í† ë¼",ì§„:"ìš©",ì‚¬:"ë±€",ì˜¤:"ë§",ë¯¸:"ì–‘",ì‹ :"ì›ìˆ­ì´",ìœ :"ë‹­",ìˆ :"ê°œ",í•´:"ë¼ì§€"};

function normalizeColor(c){
  const map = {
    "ì´ˆë¡":"ì´ˆë¡","í‘¸ë¥¸":"ì´ˆë¡","ë…¹ìƒ‰":"ì´ˆë¡","ê·¸ë¦°":"ì´ˆë¡",
    "ë¶‰ì€":"ë¶‰ì€","ë¹¨ê°•":"ë¶‰ì€","ë¹¨ê°„":"ë¶‰ì€","ì ìƒ‰":"ë¶‰ì€","ë ˆë“œ":"ë¶‰ì€",
    "ë…¸ë€":"ë…¸ë€","ë…¸ë‘":"ë…¸ë€","ì˜ë¡œ":"ë…¸ë€",
    "íšŒìƒ‰":"íšŒìƒ‰","ê·¸ë ˆì´":"íšŒìƒ‰","ì€ìƒ‰":"íšŒìƒ‰","ì‹¤ë²„":"íšŒìƒ‰","í•˜ì–€":"íšŒìƒ‰","í°ìƒ‰":"íšŒìƒ‰",
    "ë‚¨ìƒ‰":"ë‚¨ìƒ‰","íŒŒë‘":"ë‚¨ìƒ‰","íŒŒë€":"ë‚¨ìƒ‰","ë¸”ë£¨":"ë‚¨ìƒ‰","ê²€ì€":"ë‚¨ìƒ‰","ê²€ì •":"ë‚¨ìƒ‰","í‘ìƒ‰":"ë‚¨ìƒ‰"
  };
  return map[c] || c;
}

function canonicalIlju(raw){
  if(!raw) return null;
  let s = decodeURIComponent(raw).trim();

  // ê°„ì§€ 2ê¸€ì â†’ ìƒ‰ìƒ+ë™ë¬¼
  const noSpace = s.replace(/\s+/g,"");
  if(/^[ê°‘ì„ë³‘ì •ë¬´ê¸°ê²½ì‹ ì„ê³„][ìì¶•ì¸ë¬˜ì§„ì‚¬ì˜¤ë¯¸ì‹ ìœ ìˆ í•´]$/.test(noSpace)){
    const color = stemToColor[noSpace[0]];
    const animal = branchToAnimal[noSpace[1]];
    return `${color} ${animal}`;
  }
  // 'ë¶‰ì€ì¥' ê°™ì´ ë¶™ì–´ì˜¨ ê²½ìš°
  const m = noSpace.match(/(ì´ˆë¡|í‘¸ë¥¸|ë¶‰ì€|ë¹¨ê°•|ë¹¨ê°„|ë…¸ë€|íšŒìƒ‰|ë‚¨ìƒ‰|ê²€ì€|í•˜ì–€|í°ìƒ‰)(ì¥|ì†Œ|í˜¸ë‘ì´|í† ë¼|ìš©|ë±€|ë§|ì–‘|ì›ìˆ­ì´|ë‹­|ê°œ|ë¼ì§€)/);
  if(m){
    return `${normalizeColor(m[1])} ${m[2]}`;
  }
  // 'ë¶‰ì€ ì¥' ê°™ì´ ë„ì–´ì“°ê¸° ìˆëŠ” ê²½ìš°
  const parts = s.split(/\s+/);
  if(parts.length>=2 && animals.includes(parts[1])){
    return `${normalizeColor(parts[0])} ${parts[1]}`;
  }
  return s; // ë§ˆì§€ë§‰ ì‹œë„
}

// ---------------------------
// ğŸ”— íŒŒë¼ë¯¸í„°/ìŠ¤í† ë¦¬ì§€ì—ì„œ ì½ì–´ì„œ í‘œì‹œ
// ---------------------------
const params = new URLSearchParams(window.location.search);
const rawIlju = params.get('ilju') || localStorage.getItem('yourzoy_ilju');
const ilju = canonicalIlju(rawIlju);
const zone = (params.get('zone') || localStorage.getItem('yourzoy_zone') || 'A').toUpperCase();

const reportBox = document.getElementById("report");
if (ilju && reports[ilju] && reports[ilju][zone]) {
  reportBox.innerHTML = reports[ilju][zone];
} else {
  reportBox.innerHTML =
    "âš ï¸ ë°ì´í„°ê°€ ì•„ì§ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br><br>" +
    `<small>ë°›ì€ ê°’: ilju="${rawIlju ?? ''}", zone="${zone}"</small><br>` +
    `<small>í…ŒìŠ¤íŠ¸ URL ì˜ˆì‹œ: <code>result.html?ilju=${encodeURIComponent('ë¶‰ì€ ì¥')}&zone=C</code></small><br>`+
    `<small>ë˜ëŠ” ê°„ì§€ë¡œë„ ê°€ëŠ¥: <code>result.html?ilju=${encodeURIComponent('ë³‘ì')}&zone=A</code></small>`;
}
</script>
