<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>YOURZOY 사주 등록</title>
<style>
:root {--navy:#0B132B;--navy2:#1C2541;--gold:#FFD700;--text:#FFF;}
body{margin:0;background:var(--navy);color:var(--text);font-family:"Noto Sans KR",sans-serif;}
.wrap{max-width:520px;margin:6vh auto;padding:28px;border-radius:24px;background:var(--navy2);
box-shadow:0 18px 50px rgba(0,0,0,.4);}
h1{text-align:center;color:var(--gold);margin-bottom:4px;font-size:24px;}
p{text-align:center;color:rgba(255,255,255,.7);margin-bottom:24px;}
label{color:var(--gold);font-weight:700;font-size:14px;display:block;margin:10px 0 6px;}
input,select,button{width:100%;padding:13px;border:none;border-radius:12px;box-sizing:border-box;}
input,select{background:#0f1733;color:var(--text);border:1px solid rgba(255,215,0,.3);}
button{background:var(--gold);color:#111;font-weight:800;margin-top:18px;cursor:pointer;}
button:hover{filter:brightness(1.05);}
footer{text-align:center;color:rgba(255,255,255,.45);font-size:12px;margin-top:20px;}
</style>
</head>
<body>
<main class="wrap">
  <h1>YOURZOY</h1>
  <p>생년월일과 시간을 입력하면 당신의 <b>일주</b>를 찾아드릴게요.</p>
  
  <label>생년월일</label>
  <input id="birthdate" type="date">
  
  <label>출생시간</label>
  <select id="birthtime">
    <option value="0">자시 (23:00~00:59)</option>
    <option value="1">축시 (01:00~02:59)</option>
    <option value="2">인시 (03:00~04:59)</option>
    <option value="3">묘시 (05:00~06:59)</option>
    <option value="4">진시 (07:00~08:59)</option>
    <option value="5">사시 (09:00~10:59)</option>
    <option value="6">오시 (11:00~12:59)</option>
    <option value="7">미시 (13:00~14:59)</option>
    <option value="8">신시 (15:00~16:59)</option>
    <option value="9">유시 (17:00~18:59)</option>
    <option value="10">술시 (19:00~20:59)</option>
    <option value="11">해시 (21:00~22:59)</option>
  </select>

  <button id="next">성향 테스트 시작</button>
  <footer>© 2025 YOURZOY</footer>
</main>

<script>
// ======================== 천문 기준 만세력 계산 =========================
const stems = ["갑","을","병","정","무","기","경","신","임","계"];
const branches = ["자","축","인","묘","진","사","오","미","신","유","술","해"];

// Julian Day 계산
function JD(y, m, d){
  const a = Math.floor((14 - m) / 12);
  const y2 = y + 4800 - a;
  const m2 = m + 12 * a - 3;
  return d + Math.floor((153 * m2 + 2) / 5) + 365 * y2 + Math.floor(y2 / 4)
       - Math.floor(y2 / 100) + Math.floor(y2 / 400) - 32045;
}

// ✅ 정확한 갑자일 기준: 1984-02-05 00:00
const BASE_JD = JD(1984, 2, 5);

// 일주 계산
function getIlju(y, m, d){
  const diff = JD(y, m, d) - BASE_JD;
  const idx = (diff % 60 + 60) % 60;
  return stems[idx % 10] + branches[idx % 12];
}

// 년주 계산 (간단 모델)
function getNyeonju(y){ return stems[(y - 4) % 10] + branches[(y - 4) % 12]; }

// 월주 계산 (절기 단순화)
function getWolju(y, m){
  const monthStemIdx = (((y - 4) * 12 + (m + 1)) % 10 + 10) % 10;
  const monthBranchIdx = (m + 1) % 12;
  return stems[monthStemIdx] + branches[monthBranchIdx];
}

// 시주 계산
function getSiju(ilGan, h){
  const hourBranches = ["자","축","인","묘","진","사","오","미","신","유","술","해"];
  const ji = hourBranches[Math.floor((h + 3) / 2) % 12];
  const ganStart = {"갑":0,"기":0,"을":2,"병":4,"무":4,"정":6,"기":6,"경":8,"신":10,"임":0,"계":2};
  const ganIdx = (ganStart[ilGan] + Math.floor((h + 3) / 2)) % 10;
  return stems[ganIdx] + ji;
}

// 전체 4주 계산
function getFourPillars(y, m, d, h){
  const yearP = getNyeonju(y);
  const monthP = getWolju(y, m);
  const dayP = getIlju(y, m, d);
  const hourP = getSiju(dayP[0], h);
  return { yearP, monthP, dayP, hourP };
}

// ======================== 오행 / 색상 / 동물 매핑 =========================
const elementMap = {
  "갑": {elem:"목", color:"초록"},
  "을": {elem:"목", color:"초록"},
  "병": {elem:"화", color:"빨강"},
  "정": {elem:"화", color:"빨강"},
  "무": {elem:"토", color:"노랑"},
  "기": {elem:"토", color:"노랑"},
  "경": {elem:"금", color:"회색"},
  "신": {elem:"금", color:"회색"},
  "임": {elem:"수", color:"파랑"},
  "계": {elem:"수", color:"파랑"}
};

const animalMap = {
  "자":"쥐","축":"소","인":"호랑이","묘":"토끼","진":"용","사":"뱀",
  "오":"말","미":"양","신":"원숭이","유":"닭","술":"개","해":"돼지"
};

// ======================== 실행 로직 =========================
document.getElementById("next").addEventListener("click", () => {
  const dateStr = document.getElementById("birthdate").value;
  if(!dateStr) return alert("생년월일을 선택해주세요!");

  const [y, m, d] = dateStr.split("-").map(n => parseInt(n, 10));
  const h = parseInt(document.getElementById("birthtime").value);

  const pillars = getFourPillars(y, m, d, h);
  const ilGan = pillars.dayP[0];
  const ilJi = pillars.dayP[1];
  const elem = elementMap[ilGan].elem;
  const color = elementMap[ilGan].color;
  const animal = animalMap[ilJi];
  const iljuName = `${color} ${animal}`; // ex) 붉은 쥐

  const birthData = {...pillars, elem, color, animal, iljuName};
  localStorage.setItem("birthData", JSON.stringify(birthData));

  // 디버그용 콘솔 출력
  console.log("✅ 계산 결과:", birthData);

  // 다음 페이지로 이동
  window.location.href = "survey.html";
});
</script>
</body>
</html>
