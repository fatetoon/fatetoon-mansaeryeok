<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>YOURZOY 조이찾기</title>
<style>
:root {--navy:#0B132B;--navy2:#1C2541;--gold:#FFD700;--text:#FFF;}
body{margin:0;background:var(--navy);color:var(--text);font-family:"Noto Sans KR",sans-serif;}
.wrap{max-width:520px;margin:6vh auto;padding:28px;border-radius:24px;background:var(--navy2);
box-shadow:0 18px 50px rgba(0,0,0,.4);}
h1{text-align:center;color:var(--gold);margin-bottom:4px;font-size:24px;}
p{text-align:center;color:rgba(255,255,255,.7);margin-bottom:24px;}
label{color:var(--gold);font-weight:700;font-size:14px;display:block;margin:10px 0 6px;}
input,select,button{width:100%;padding:13px;border:none;border-radius:12px;box-sizing:border-box;}
input,select{background:#0f1733;color:var(--text);border:1px solid rgba(255,215,0,.3);}
button{background:var(--gold);color:#111;font-weight:800;margin-top:18px;cursor:pointer;}
button:hover{filter:brightness(1.05);}
footer{text-align:center;color:rgba(255,255,255,.45);font-size:12px;margin-top:20px;}
</style>
</head>
<body>
<main class="wrap">
  <h1>YOURZOY</h1>
  <p>생년월일과 시간을 입력하면 당신의 <b>조이</b>를 찾아드릴게요.</p>
  <label>생년월일</label>
  <input id="birthdate" type="date">
  <label>출생시간</label>
  <select id="birthtime">
    <option value="0">자시 (23:00~00:59)</option>
    <option value="1">축시 (01:00~02:59)</option>
    <option value="2">인시 (03:00~04:59)</option>
    <option value="3">묘시 (05:00~06:59)</option>
    <option value="4">진시 (07:00~08:59)</option>
    <option value="5">사시 (09:00~10:59)</option>
    <option value="6">오시 (11:00~12:59)</option>
    <option value="7">미시 (13:00~14:59)</option>
    <option value="8">신시 (15:00~16:59)</option>
    <option value="9">유시 (17:00~18:59)</option>
    <option value="10">술시 (19:00~20:59)</option>
    <option value="11">해시 (21:00~22:59)</option>
  </select>
  <button id="next">성향 테스트 시작</button>
  <footer>© 2025 YOURZOY</footer>
</main>

<script>
/* ===== FATETOON 만세력 - 최종본 (정확도 검증 완료) =====
   검증: 
     1995-02-14 17:00 → 을해 / 무인 / 병자 / 병신
     2001-08-07 13:00 → 신사 / 을미 / 임인 / 정미
     1974-12-17 18:00 → 갑인 / 병자 / 임진 / 기유
     2004-01-28 04:28 → 계미 / 을축 / 병오 / 경인
     2003-12-11 08:00 → 계미 / 갑자 / 무오 / 병진
*/

document.getElementById("next").addEventListener("click", calculateSaju);

function calculateSaju() {
  const birthStr = document.getElementById("birthdate").value;
  const hourBranchIndex = parseInt(document.getElementById("birthtime").value); // 0~11

  if (!birthStr) return alert("⚠️ 생년월일을 입력해주세요.");

  const birthDate = new Date(birthStr + "T12:00:00"); // 타임존 보정
  const y = birthDate.getFullYear();
  const m = birthDate.getMonth() + 1;
  const d = birthDate.getDate();

  const stems = ["갑","을","병","정","무","기","경","신","임","계"];
  const branches12 = ["자","축","인","묘","진","사","오","미","신","유","술","해"];

  // ① 년주
  const adjYear = (m < 2 || (m === 2 && d < 4)) ? y - 1 : y;
  const yearStem = stems[(adjYear - 4) % 10];
  const yearBranch = branches12[(adjYear - 4) % 12];
  const yearGanji = yearStem + yearBranch;

  // ② 월주 (절입일 보정)
  const boundaries = {2:4,3:6,4:5,5:6,6:6,7:7,8:8,9:8,10:8,11:7,12:7,1:6};
  const monthOrder = {2:0,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:9,12:10,1:11};

  let monthBranchIdx;
  if (m === 1 && d < boundaries[1]) monthBranchIdx = 11;
  else {
    const usePrev = (d < boundaries[m]);
    const key = usePrev ? (m > 1 ? m - 1 : 12) : m;
    monthBranchIdx = monthOrder[key];
  }
  const monthBranches = ["인","묘","진","사","오","미","신","유","술","해","자","축"];
  const monthBranch = monthBranches[monthBranchIdx];

  const yearStemIdx = (adjYear - 4) % 10;
  let tigerStemIdx;
  if (yearStemIdx === 0 || yearStemIdx === 5) tigerStemIdx = 2;
  else if (yearStemIdx === 1 || yearStemIdx === 6) tigerStemIdx = 4;
  else if (yearStemIdx === 2 || yearStemIdx === 7) tigerStemIdx = 6;
  else if (yearStemIdx === 3 || yearStemIdx === 8) tigerStemIdx = 8;
  else tigerStemIdx = 0;

  const monthStem = stems[(tigerStemIdx + monthBranchIdx) % 10];
  const monthGanji = monthStem + monthBranch;

  // ③ 일주 (JDN)
  const dayGanji = getDayGanjiJDN(y, m, d, stems, branches12);

  // ④ 시주 (일간 + 시간)
  const dayStemIdx = stems.indexOf(dayGanji[0]);
  const hourStemIdx = (dayStemIdx * 2 + hourBranchIndex) % 10;
  const hourGanji = stems[hourStemIdx] + branches12[hourBranchIndex];

  // ✅ 데이터 저장
  const birthData = {
    yearP: yearGanji,
    monthP: monthGanji,
    dayP: dayGanji,
    hourP: hourGanji,
    iljuName: dayGanji,
    elem: getElement(dayGanji[0]).elem,
    color: getElement(dayGanji[0]).color,
    animal: getAnimal(dayGanji[1])
  };

  localStorage.setItem("birthData", JSON.stringify(birthData));
  console.log("✅ 계산 완료:", birthData);
  window.location.href = "survey.html";
}

/* ===== Julian Day 기반 일주 계산 ===== */
function getDayGanjiJDN(y, m, d, stems, branches) {
  const jdnBase = JD(1984, 2, 2); // 갑자일 기준
  const j = JD(y, m, d);
  const idx = (j - jdnBase + 2) % 60;
  return stems[idx % 10] + branches[idx % 12];
}

/* ===== Julian Day ===== */
function JD(y, m, d) {
  const a = Math.floor((14 - m) / 12);
  const y2 = y + 4800 - a;
  const m2 = m + 12 * a - 3;
  return d + Math.floor((153 * m2 + 2) / 5) + 365 * y2 + Math.floor(y2 / 4)
       - Math.floor(y2 / 100) + Math.floor(y2 / 400) - 32045;
}

/* ===== 오행 / 동물 매핑 ===== */
function getElement(gan){
  const map={
    "갑":{elem:"목",color:"초록"},
    "을":{elem:"목",color:"초록"},
    "병":{elem:"화",color:"빨강"},
    "정":{elem:"화",color:"빨강"},
    "무":{elem:"토",color:"노랑"},
    "기":{elem:"토",color:"노랑"},
    "경":{elem:"금",color:"회색"},
    "신":{elem:"금",color:"회색"},
    "임":{elem:"수",color:"파랑"},
    "계":{elem:"수",color:"파랑"}
  };
  return map[gan];
}
function getAnimal(ji){
  const map={"자":"쥐","축":"소","인":"호랑이","묘":"토끼","진":"용","사":"뱀","오":"말","미":"양","신":"원숭이","유":"닭","술":"개","해":"돼지"};
  return map[ji];
}
</script>
</body>
</html>

