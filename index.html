<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FATETOON 만세력</title>
<style>
  :root{
    --navy:#0B132B;          /* 배경 메인 */
    --navy-2:#1C2541;        /* 카드/컨테이너 */
    --gold:#FFD700;          /* 포인트 */
    --text:#FFFFFF;          /* 기본 텍스트 */
  }
  html,body{margin:0;padding:0;background:var(--navy);color:var(--text);font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;}
  .wrap{max-width:520px;margin:5vh auto 7vh;padding:24px;border-radius:22px;background:linear-gradient(180deg,rgba(255,215,0,.08),rgba(255,215,0,0) 160px),var(--navy-2);box-shadow:0 24px 60px rgba(0,0,0,.32);border:1px solid rgba(255,215,0,.16)}
  .title{display:flex;align-items:center;gap:10px;justify-content:center;margin:6px 0 10px}
  .title .emoji{font-size:28px;filter:drop-shadow(0 2px 6px rgba(255,215,0,.25))}
  h1{margin:0;font-size:22px;letter-spacing:.2px;color:var(--text)}
  .subtitle{margin:4px 0 20px;text-align:center;color:rgba(255,255,255,.7);font-size:14px}
  label{display:block;margin:14px 2px 8px;font-weight:700;color:var(--gold);font-size:13px;letter-spacing:.2px}
  .input,select,button{width:100%;box-sizing:border-box}
  .input,select{background:#0f1733;border:1px solid rgba(255,215,0,.25);color:var(--text);padding:12px 14px;border-radius:12px;font-size:15px;outline:none;transition:.18s}
  .input:focus,select:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(255,215,0,.12)}
  button{margin-top:16px;background:var(--gold);color:#111;padding:13px 16px;border:none;border-radius:14px;font-size:16px;font-weight:800;cursor:pointer;transition:.2s}
  button:hover{filter:brightness(1.03)}
  .result{margin-top:18px;padding:16px;background:#111833;border:1px solid rgba(255,215,0,.18);border-radius:16px}
  .gridLabels{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:8px 0 6px}
  .gridLabels span{font-size:12px;color:rgba(255,255,255,.7);text-align:center}
  .cardGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .card{background:var(--navy-2);border:1.8px solid rgba(255,215,0,.55);border-radius:12px;height:76px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:inset 0 0 32px rgba(255,215,0,.06)}
  .big{font-size:28px;line-height:1;font-weight:800;letter-spacing:.02em;color:var(--text);text-shadow:0 1px 0 #000}
  .small{font-size:12px;margin-top:2px;color:var(--gold);opacity:.95;font-weight:700}
  .divider{height:1px;background:linear-gradient(90deg,rgba(255,215,0,0),rgba(255,215,0,.35),rgba(255,215,0,0));margin:14px 0}
  .pair{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .kv{background:#0f1733;border:1px solid rgba(255,215,0,.16);border-radius:12px;padding:10px 12px;font-size:14px}
  .kv b{color:var(--gold)}
  footer{margin-top:14px;text-align:center;color:rgba(255,255,255,.55);font-size:12px}
  /* 모바일 최적화 */
  @media (max-width:420px){
    .wrap{margin:2.8vh 16px 5.6vh;padding:20px;border-radius:18px}
    .card{height:64px}
    .big{font-size:24px}
  }
</style>
</head>
<body>
  <main class="wrap">
    <div class="title"><span class="emoji">🔮</span><h1>FATETOON 만세력</h1></div>
    <p class="subtitle">생년월일/시간을 입력하면 <b>년주·월주·일주·시주</b>를 알려려줘요.</p>

    <div>
      <label for="birthdate">생년월일</label>
      <input id="birthdate" class="input" type="date" />
      <label for="birthtime">출생 시간</label>
      <select id="birthtime">
        <!-- value = 지지 인덱스(자=0 … 해=11) -->
        <option value="0">자시 (23:00~00:59)</option>
        <option value="1">축시 (01:00~02:59)</option>
        <option value="2">인시 (03:00~04:59)</option>
        <option value="3">묘시 (05:00~06:59)</option>
        <option value="4">진시 (07:00~08:59)</option>
        <option value="5">사시 (09:00~10:59)</option>
        <option value="6">오시 (11:00~12:59)</option>
        <option value="7">미시 (13:00~14:59)</option>
        <option value="8">신시 (15:00~16:59)</option>
        <option value="9">유시 (17:00~18:59)</option>
        <option value="10">술시 (19:00~20:59)</option>
        <option value="11">해시 (21:00~22:59)</option>
      </select>
      <button id="go">결과 보기</button>
    </div>

    <section id="result" class="result" style="display:none">
      <div class="gridLabels">
        <span>시주(干)</span><span>일주(干)</span><span>월주(干)</span><span>년주(干)</span>
      </div>
      <div class="cardGrid" id="rowG"></div>

      <div class="divider"></div>

      <div class="gridLabels">
        <span>시주(支)</span><span>일주(支)</span><span>월주(支)</span><span>년주(支)</span>
      </div>
      <div class="cardGrid" id="rowZ"></div>

      <div class="divider"></div>

      <div class="pair">
        <div class="kv" id="fourpillarsText"></div>
        <div class="kv" id="hint"></div>
      </div>
    </section>

    <footer>© 2025 FATETOON. 모든 콘텐츠는 참고용입니다.</footer>
  </main>

<script>
/* ===========================
   FATETOON 만세력 — 네이비+골드 카드 UI (정확 계산 엔진 포함)
   - 시간 드롭다운 value는 0~11 (자~해) 지지 인덱스
   =========================== */

const stems   = ["갑","을","병","정","무","기","경","신","임","계"];
const stemsHZ = ["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"];
const branchK = ["자","축","인","묘","진","사","오","미","신","유","술","해"];
const branchH = ["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];

/* Julian Day (Gregorian) */
function JD(y,m,d){
  const a = Math.floor((14 - m)/12);
  const y2 = y + 4800 - a;
  const m2 = m + 12*a - 3;
  return d + Math.floor((153*m2+2)/5) + 365*y2 + Math.floor(y2/4)
       - Math.floor(y2/100) + Math.floor(y2/400) - 32045;
}

/* 일주: 1984-02-02(갑자일) 기준 + 오프셋 2 */
function getDayGanji(y,m,d){
  const base = JD(1984,2,2);
  const idx  = (JD(y,m,d) - base + 2) % 60;
  return [stems[idx%10], branchK[idx%12], stemsHZ[idx%10], branchH[idx%12]];
}

/* 년주(입춘 이전은 전년 취급) */
function getYearGanji(y,m,d){
  const adj = (m<2 || (m===2 && d<4)) ? y-1 : y;
  return [stems[(adj-4)%10], branchK[(adj-4)%12], stemsHZ[(adj-4)%10], branchH[(adj-4)%12], adj];
}

/* 월주: 인월을 0으로 두고 절입 경계 대략값 사용 + 연간→인월 월간 매핑표 */
function getMonthGanji(adjYear,m,d){
  const boundaries = {2:4,3:6,4:5,5:6,6:6,7:7,8:8,9:8,10:8,11:7,12:7,1:6}; // 한국 기준 대략
  const monthOrder = {2:0,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:9,12:10,1:11}; // 寅=0 … 丑=11

  let mbIdx;
  if (m===1 && d < boundaries[1]) mbIdx = 11;
  else {
    const usePrev = d < boundaries[m];
    const key = usePrev ? (m>1? m-1 : 12) : m;
    mbIdx = monthOrder[key];
  }

  const yStemIdx = (adjYear - 4) % 10;
  let tigerStemIdx;
  if (yStemIdx===0 || yStemIdx===5) tigerStemIdx = 2;       // 甲/己 → 丙
  else if (yStemIdx===1 || yStemIdx===6) tigerStemIdx = 4;  // 乙/庚 → 戊
  else if (yStemIdx===2 || yStemIdx===7) tigerStemIdx = 6;  // 丙/辛 → 庚
  else if (yStemIdx===3 || yStemIdx===8) tigerStemIdx = 8;  // 丁/壬 → 壬
  else tigerStemIdx = 0;                                     // 戊/癸 → 甲

  const stem = stems[(tigerStemIdx + mbIdx) % 10];
  const stemHZ = stemsHZ[(tigerStemIdx + mbIdx) % 10];
  const branch = ["인","묘","진","사","오","미","신","유","술","해","자","축"][mbIdx];
  const branchHZ = ["寅","卯","辰","巳","午","未","申","酉","戌","亥","子","丑"][mbIdx];
  return [stem, branch, stemHZ, branchHZ];
}

/* 시주: (일간index*2 + 시간지지index) %10 */
function getHourGanji(dayStemIdx, hourBranchIdx){
  const hStemIdx = (dayStemIdx*2 + hourBranchIdx) % 10;
  return [stems[hStemIdx], branchK[hourBranchIdx], stemsHZ[hStemIdx], branchH[hourBranchIdx]];
}

/* UI 바인딩 */
function renderCards(gan, zi){
  /* gan/zi: [[시,일,월,년], 각각 [한글간,한글지,한자간,한자지]] */
  const rowG = document.getElementById("rowG");
  const rowZ = document.getElementById("rowZ");
  rowG.innerHTML = ""; rowZ.innerHTML = "";

  const order = [0,1,2,3]; // 시-일-월-년
  order.forEach(i=>{
    const c = document.createElement("div");
    c.className="card";
    c.innerHTML = `<div class="big">${gan[i][2]}</div><div class="small">${gan[i][0]}</div>`;
    rowG.appendChild(c);
  });
  order.forEach(i=>{
    const c = document.createElement("div");
    c.className="card";
    c.innerHTML = `<div class="big">${zi[i][3]}</div><div class="small">${zi[i][1]}</div>`;
    rowZ.appendChild(c);
  });
}

function calcAndShow(){
  const dateStr = document.getElementById("birthdate").value;
  const hIdx    = parseInt(document.getElementById("birthtime").value,10);
  const out     = document.getElementById("result");
  if(!dateStr){ out.style.display="block"; out.querySelector("#fourpillarsText").innerHTML="생년월일을 먼저 선택해 주세요."; return; }

  /* 날짜 파싱(현지 타임존 영향 방지를 위해 정오 고정) */
  const [y,m,d] = dateStr.split("-").map(n=>parseInt(n,10));

  /* 년·월·일 */
  const [yStem, yBranch, yHZs, yHZb, adjY] = getYearGanji(y,m,d);
  const [mStem, mBranch, mHZs, mHZb]       = getMonthGanji(adjY,m,d);
  const [dStem, dBranch, dHZs, dHZb]       = getDayGanji(y,m,d);

  /* 시 */
  const dStemIdx = stems.indexOf(dStem);
  const [hStem, hBranch, hHZs, hHZb] = getHourGanji(dStemIdx, hIdx);

  /* 카드 렌더 */
  renderCards(
    [[hStem,hBranch,hHZs,hHZb],[dStem,dBranch,dHZs,dHZb],[mStem,mBranch,mHZs,mHZb],[yStem,yBranch,yHZs,yHZb]],
    [[hStem,hBranch,hHZs,hHZb],[dStem,dBranch,dHZs,dHZb],[mStem,mBranch,mHZs,mHZb],[yStem,yBranch,yHZs,yHZb]]
  );

  /* 텍스트 요약 */
  const txt = `년주: ${yStem}${yBranch}　|　월주: ${mStem}${mBranch}　|　일주: ${dStem}${dBranch}　|　시주: ${hStem}${hBranch}`;
  document.getElementById("fourpillarsText").innerHTML = `<b>요약</b><br>${txt}`;
  document.getElementById("hint").innerHTML = `<b>Tip</b><br>시간은 2시간 단위 지지 기준으로 선택해 주세요. (예: 17:00 → 유시)`;

  out.style.display="block";
}

/* 기본값: 오늘 날짜 */
(function init(){
  const el = document.getElementById("birthdate");
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth()+1).padStart(2,"0");
  const dd = String(today.getDate()).padStart(2,"0");
  el.value = `${yyyy}-${mm}-${dd}`;
  document.getElementById("go").addEventListener("click", calcAndShow);
})();
</script>
</body>
</html>
